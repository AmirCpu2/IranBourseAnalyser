var app=angular.module("TSEPages",[]),developmentMode=0,prefix="";developmentMode||(prefix="/");var srchCtrl=function(n,e,r){n.symbol_search=!0,n.currentSrchLabel="نماد",n.inLoadingState=!0,n.isDataLoaded=!1,n.query="",n.data=[],n.showResult=!1,n.currentIdx=0,n.ellipsesThresh=33,n.rowGrade=20,n.uiDelay=20,n.makeActive=function(e){n.currentIdx=e},n.ellipses=function(e,t){var r=e+" - "+t;return r.length>n.ellipsesThresh?r.substring(0,n.ellipsesThresh)+"...":r},n.clearQuery=function(){n.query=""},n.changeToSiteSearch=function(){n.clearQuery(),n.symbol_search=!1,n.showResult=!1},n.changeToSymbolSearch=function(){n.clearQuery(),n.symbol_search=!0},n.loadData=function(){n.isDataLoaded=!0,e.get(prefix+"json/HomePage/search.json?j_"+Math.random()).success(function(e){n.fillTable(e.searchItems,0)})},n.mayLoadData=function(){n.isDataLoaded||n.loadData()},n.fillTable=function(e,t){t>=e.length?n.endFillTable():r(function(){n.data=n.data.concat(e.slice(t,t+n.rowGrade)),n.fillTable(e,t+n.rowGrade)},n.uiDelay)},n.endFillTable=function(){n.inLoadingState=!1,t()};var t=function(){};n.change=function(){if(n.symbol_search){n.query=n.query.replace(/\ی/g,"ي").replace(/\ک/g,"ك");var e=n.query.length;n.currentIdx=0,1!=e||n.isDataLoaded?2<e?n.showResult=!0:0==e&&(n.showResult=!1):n.loadData()}},n.keyPressed=function(e){switch(e){case 38:n.currentIdx=null==n.currentIdx?0:(--n.currentIdx+n.filterItems.length)%n.filterItems.length;break;case 40:n.currentIdx=null==n.currentIdx?0:++n.currentIdx%n.filterItems.length;break;case 13:try{n.goToURL(n.filterItems[n.currentIdx].i,n.filterItems[n.currentIdx].s)}catch(e){}break;case 27:n.showResult=!1}n.$apply(),n.$broadcast("items_changed")},n.goToURL=function(e,t){window.location="http://new.tse.ir/instrument/"+t+"_"+e+".html"},n.computeTitle=function(e,t){var r=e.replace(/\D/g,"");return r=r.substring(0,r.length-1)+""+t,e.split(/[0-9]+/)[0]+r},n.linkPref="http://new.tse.ir/instrument/",n.computeLink=function(e,t,r){return e+"_"+t.substring(0,t.length-1)+r+".html"},n.submitSearch=function(){if(n.symbol_search)return!1;document.getElementById("siteForm").submit()}};srchCtrl.$inject=["$scope","$http","$timeout"],app.directive("tseHeaderModule",function(){return{templateUrl:prefix+"txt/header-ang.html",link:function(e,t,r){var n=t.find("#ajaxResult-ang");e.$on(r.scrollToApprop,function(){n[0].scrollTop=55*e.currentIdx}),$("#symbolForm").on("submit",function(){return!1}),$("body").on("click",function(){e.showResult=!1,e.$apply()}),t.on("click",".searchBox",function(e){e.stopPropagation()})},replace:!0,scope:{model:"="},controller:srchCtrl}}),app.controller("SearchCtrl",["$scope","$http",srchCtrl]),app.directive("ngKeydown",function(){return{restrict:"A",link:function(t,e,r){e.on("keydown",function(e){t.keyPressed(e.which)})},controller:srchCtrl}});var overlayCtrl=function(e,t){e.current_c="",e.setCookie=function(e,t,r){var n=new Date;n.setTime(n.getTime()+24*r*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=e+"="+t+"; "+o},e.getCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""};var r=t.cn;""==e.getCookie("tse_overlay_"+r)&&(e.showOverlay=!0,$("body").addClass("overflow-hidden"),e.setCookie("tse_overlay_"+r,"already_seen",15))};overlayCtrl.$inject=["$scope","$attrs"],app.controller("OverlayCtrl",["$scope","$attrs",overlayCtrl]),app.directive("overlay",function(){return{templateUrl:prefix+"txt/popup.html",link:function(e,t,r){var n=t.parent("body");e.imgW=r.w,e.imgH=r.h,$box=t.find("#overlay-box").width(r.w);var o=(window.innerHeight-e.imgH)/2;$box.css("marginTop",o-15+"px");var i=t.find("#overlay-close");t.on("click",function(){e.showOverlay=!1,n.removeClass("overflow-hidden")}),i.on("click",function(e){t.hide(),n.removeClass("overflow-hidden")})},replace:!0,scope:{model:"="},controller:overlayCtrl}});var navCtrl=function(){};app.controller("NavCtrl",["$scope","$http",navCtrl]),app.directive("tseNavModule",function(){return{templateUrl:prefix+"txt/nav.html?201808201039",link:function(e,t,r){var n=t.find("li.menuItem");t.find("div.subHolder").on("click",function(){$(this).hide()}),n.hover(function(){var e=$(this);e.find("div.slideHide").slideDown(200),e.find(".multiLevelIndic").hide()},function(){var e=$(this);e.find("div.slideHide").finish().hide(),e.find(".multiLevelIndic").show()})},replace:!0,scope:{model:"="},controller:navCtrl}});