!function(e){e.ajaxSetup({cache:!1});var t=null,o=null,n=[],s=e(window),r={$body:e("body"),$html:e("html"),$document:e(document)},a=0,p=0==e(".updatePlotTime").length?!1:!0;if(p)var l=e(".sampleBullet");var d=function(){var t=this;this.$obj,this.$fakeBack=0==e(document.getElementById("fakeBack")).length?e("<div>",{id:"fakeBack"}).prependTo(e("body")):e(document.getElementById("fakeBack")),this.$fakeBack.on("click",function(o){"fakeBack"==e(o.target).attr("id")&&t.disappearFake()}),this.disappearFake=function(){var e=t.$obj;e.removeClass("activeFake").animate({top:1100},2e3,"easeOutQuint",function(){}).hide(),t.$fakeBack.fadeOut(400,function(){e.children("div.closeButton").css({top:"-50px",display:"none"})})},e("html").on("click","div.closeButton",function(){t.disappearFake.call(t)}),this.closeButtonTrans=function(){this.$closeButton.fadeIn().animate({top:-23},{duration:400,queue:!1},"easeOutQuint")},this.createFakeWindow=function(t){0!=e(document.getElementById(t)).length?this.$obj=e(document.getElementById(t)):(this.$obj=e("<div>",{id:t,"class":"fakeWindow"}).appendTo(this.$fakeBack),this.$fakeContent=e("<div>",{"class":"fakeContent"}).appendTo(this.$obj),this.$noMsg=e("<p>",{"class":"noMsg"}).appendTo(this.$fakeContent),this.$closeButton=e("<div>",{"class":"closeButton spriteImg"}).appendTo(this.$obj)),this.initiateFake()},this.initiateFake=function(){var e=this.$obj;e.css({width:"50%",left:"25%"})},this.showFakeWin=function(e){var t=this;this.$fakeBack.fadeIn(200,function(){t.$obj.finish().show().addClass("activeFake").animate({top:80},500,"easeOutQuint",function(){t.closeButtonTrans(),e.text(t.$fakeContent.children("div.notSeen").length+10)}),t.$fakeContent[0].scrollTop=0})}},c=function(t){this.$obj=e("<li>",{"class":"miniLi"}),this.spanTitle=e("<span>",{"class":"exTitle",html:t.t+"<span class:'en'> : <span>"}).appendTo(this.$obj),this.spanTarget=e("<span>",{"class":"exTarget"}).appendTo(this.$obj),f.prototype.$miniSliderTargetArr.push(this.spanTarget),void 0!=t.cur&&(this.spanCur=e("<span>",{"class":"exCurrency",text:t.cur}).appendTo(this.$obj)),void 0!=t.hasTail&&(this.tailSpan=e("<span>",{"class":"exTitle",html:"<span class='en'> ( </span>"+t.tail.t}).appendTo(this.$obj),this.tailTarget=e("<span>",{"class":"exTarget"}).appendTo(this.tailSpan),f.prototype.$miniSliderTargetArr.push(this.tailTarget),this.tailSpan.append("<span class='en'> ) </span>"))},h=function(t,o,n,i,s){this.$obj=e("<li>",{"class":"expandIcon spriteImg",id:"ex"+i}).appendTo(t),this.$anchore=e("<a>",{href:o,"class":"exWrap tooltip",title:n,target:"_blank"}).appendTo(this.$obj).mkfTT({fsize:10,padding:"6px"}),void 0!=s&&(this.$counter=e("<span>",{"class":"exMsgNote",text:"0"}).appendTo(this.$obj))},u=function(s){this.$obj=e("<ul>",{"class":"expandUl",id:s});var r=this;this.createRightContent=function(){f.prototype.$miniSliderTargetArr=[];var t=[{t:"شاخص کل",border:1},{dl:1,border:1,sub:[{t:"حجم معاملات",cur:"میلیون سهم"},{t:"تعداد معاملات"}]},{dl:1,sub:[{t:"ارزش معاملات",cur:"میلیون ریال"},{t:"آخرین معاملات",hasTail:1,tail:{t:"وضعیت بازار: "}}]}];e.each(t,function(t,o){var n=e("<li>",{"class":"expandInfo"}).appendTo(r.$obj);if(void 0!=o.border&&n.addClass("borderDivide spriteImg"),void 0==o.dl){n.addClass("entireRow");var i=(e("<span>",{"class":"exTitle",html:o.t+"<span class='en'> : <span>"}).appendTo(n),e("<span>",{"class":"exTarget"}).appendTo(n));f.prototype.$miniSliderTargetArr.push(i)}else{n.addClass("hasUl");var s=e("<ul>",{"class":"innerUl"}).appendTo(n),a=new c(o.sub[0]);s.append(a.$obj);var a=new c(o.sub[1]);s.append(a.$obj)}})},this.createLeftContent=function(){var s=e("body"),r={obj:new h(this.$obj,"#","پیام ناظر","Msg","counter"),win:new d,freezTimeOut:7e4,updateIntervalTime:2e4,notifyCounter:function(e){if(e){this.obj.$counter.show();var t="#1c2466";this.obj.$counter.animate({backgroundColor:t},300),this.obj.$obj.addClass("msgReady")}else this.obj.$counter.hide(),this.obj.$obj.removeClass("msgReady"),f.prototype.$sliderOpen.css({backgroundColor:"rgb(156,156,156)",backgroundColor:"rgba(156,156,156,.5)"})},correct:function(e){var t=3-e.length;for(i=0;t>i;i++)e="0"+e;return e},addSeprator:function(e){var t=e.toString().indexOf("."),o="";if(-1!=t){var n=parseInt(e.toString().substring(0,t));o=e.toString().substring(t),e=n}var s="";if(1e3>e&&e>-1e3)return e.toString()+o;0>e&&(e-=2*e,s="-");for(var r=[],a=e,p="";a>=1e3;){var l=String(a%1e3);l.length<3&&(l=this.correct(l)),r.push(l),a=parseInt(a/1e3)}for(p+=s+a,i=r.length-1;i>=0;i--)p+=","+r[i];return p+o},htmlFriendly:function(e){return e=e.replace(/\(+/g,"<span class='en'>(</span>"),e=e.replace(/\)+/g,"<span class='en'>)</span>"),e=e.replace(/\-+/g,"<span class='en'>-</span>"),e=e.replace(/\.+/g,"<span class='en'>.</span>"),e=e.replace(/\:+/g,"<span class='en'>:</span>")},makeMsg:function(e,t,o,n,i){var s=0==i?"alreadySeen":"notSeen",r="<div class='msg "+s+"' id='msg_"+e+"'><div class='msgHeader'>";return r+="<h4 class='msgTitle clearfix'>"+this.htmlFriendly(t),0!=i&&(r+="<span class='newMark'> (جدید)</span>"),r+="</h4>",r+="<div class='msgWhen'>"+this.htmlFriendly(o)+"</div></div>",r+="<p class='msgTxt'>"+this.htmlFriendly(n)+"</p></div>"},updateMsgCounter:function(){this.obj.$counter.text(this.win.$fakeContent.children("div.notSeen").length)},updateNazerMsg:function(){e.getJSON("/json/HomePage/nazerMSG.json",function(o){var i="";e.each(o.miniSlider,function(t,o){4>t?(o=r.addSeprator(o),e(f.prototype.$miniSliderTargetArr[t]).html(r.htmlFriendly(o))):4==t?(i+=r.htmlFriendly(o.date),i+=r.htmlFriendly(" - "+o.h)):f.prototype.closeOrOpen(o)}),e(f.prototype.$miniSliderTargetArr[4]).html(i),e(".updateTxt .dynamicTxt").html(i);var s=!1;e.each(o.nazerMsg,function(){var t=!1,o=this;e.each(n,function(e,n){o.t==n&&(t=!0)}),t||(n.push(o.t),s=!0,r.win.$fakeContent.prepend(r.makeMsg(o.id,o.t,o.w,o.c,a)),r.updateMsgCounter())}),s&&a>0&&(r.notifyCounter(!0),f.prototype.considerSlider()),a++,t=window.setTimeout(r.updateNazerMsg,r.updateIntervalTime)})},startUpdate:function(){t=window.setTimeout(r.updateNazerMsg,r.updateIntervalTime)},stopUpdate:function(){t&&(window.clearTimeout(t),t=null)},breakFreez:function(){f.prototype.sliderObj.removeClass("freez"),r.updateNazerMsg(),r.startFreezOp(),s.off("mousemove.ribonStartOp").on("mousemove.ribonStopFreez",function(){r.stopFreezOp()})},freez:function(){r.stopUpdate(),f.prototype.sliderObj.addClass("freez"),s.off("mousemove.ribonStopFreez").on("mousemove.ribonStartOp",function(){r.breakFreez()})},stopFreezOp:function(){o&&(window.clearTimeout(o),o=null),r.startFreezOp()},startFreezOp:function(){o=window.setTimeout(r.freez,r.freezTimeOut)}};r.startFreezOp(),r.updateNazerMsg(),s.on("mousemove.ribonStopFreez",function(){r.stopFreezOp()}),r.win.createFakeWindow("nazer"),r.obj.$obj.on("click",function(e){e.preventDefault(),r.win.$fakeContent.children("div.active").removeClass("active").addClass("deactive"),r.notifyCounter(!1);var t=r.win.$fakeContent.children("div.notSeen");0!=t.length&&(t.filter(":odd").addClass("oddMsg"),t.removeClass("notSeen").addClass("alreadySeen active")),0==r.win.$fakeContent.children("div.msg").length?r.win.$noMsg.show():r.win.$noMsg.hide(),r.win.showFakeWin(r.obj.$counter)});new h(this.$obj,"http://new.tse.ir/indices.html","شاخص","Sh"),new h(this.$obj,"http://new.tse.ir/archive.html","آرشیو","Ar"),new h(this.$obj,"http://new.tse.ir/MarketWatch.html","نمای بازار","N")}},f=function(t,o){var n=this,i=o.threshold;this.createRight=function(){var e=new u("expandR",this);e.createRightContent(),this.$expandContent.append(e.$obj)},this.createLeft=function(){var e=new u("expandL",this);e.createLeftContent(),this.$expandContent.append(e.$obj)},this.$holder=e("<div>",{"class":"slider"}).css({width:t.innerWidth()+"px"}).hover(function(){e(this).addClass("moreZ")},function(){e(this).removeClass("moreZ")}),e(window).on("resize",function(){n.$holder.css({width:t.innerWidth()+"px"})}),f.prototype.sliderObj=this.$holder,void 0==i&&(i=e("<div>",{"class":"RibonFakeThreshold"}).appendTo(t)),this.$holder.insertBefore(i),f.prototype.$threshold=i,f.prototype.xPos=this.$holder.offset().left,f.prototype.yPos=this.$holder.offset().top;var r=f.prototype.findDocHeight();void 0!=o.pos?f.prototype.sliderObj.css("position",o.pos):r>s.height()&&f.prototype.sliderObj.css("position","fixed"),f.prototype.closeOrOpen=function(t){var o,n,i;-1!=t.iH.indexOf(":")?(o=t.iH.substring(0,t.iH.indexOf(":")),i=t.iH.substring(t.iH.indexOf(":")+1),i=i.replace(/\s/g,""),o=o.replace(/\s/g,"")):o=t.iH.replace(/\s/g,""),n=parseInt(o)<12||12==parseInt(o)&&parseInt(i)<=29?"blinking":"noBlink",p&&l.removeClass("blinking").removeClass("noBlink").addClass(n),"blinking"==n?e(f.prototype.$miniSliderTargetArr[5]).text("باز").css("color","#046814"):e(f.prototype.$miniSliderTargetArr[5]).text("بسته").css("color","#c01d52")},f.prototype.movingRibon=function(){f.prototype.findScrollTop()>0&&n.$holder.css("position","fixed"),s.scroll(function(){var e=n.$holder.innerHeight(),t=f.prototype.findScrollTop(),o=s.height(),i=f.prototype.$threshold.offset().top;t+o-e>=i?n.$holder.css("position","relative"):i>t+o&&n.$holder.css("position","fixed")})}(),this.$sliderOpen=e("<div>",{"class":"sliderOpen spriteImg tooltip",title:"خلاصه آمار"}).hover(function(){n.hoverAllow&&e(this).css({backgroundColor:"rgb(156,156,156)",backgroundColor:"rgba(156,156,156,1)"})},function(){n.hoverAllow&&e(this).css({backgroundColor:"rgb(156,156,156)",backgroundColor:"rgba(156,156,156,.5)"})}).on("click",function(){n.$expandHolder.find("ul.expandUl").delay(100).fadeIn(300),n.$expandHolder.animate({width:t.innerWidth()},{duration:400,queue:!1,easing:"easeOutQuint"}).fadeIn(300)}).mkfTT({fsize:10,padding:"6px"}).appendTo(this.$holder),f.prototype.$sliderOpen=this.$sliderOpen,this.$expandHolder=e("<div>",{"class":"expand"}).appendTo(this.$holder),this.$expandContent=e("<div>",{"class":"expandContent"}).appendTo(this.$expandHolder),this.$sliderClose=e("<div>",{"class":"sliderClose spriteImg"}).on("click",function(){n.$expandHolder.find("ul.expandUl").hide(),n.$expandHolder.fadeOut(200).animate({width:0},{duration:400,queue:!1,easing:"easeOutQuint"})}).appendTo(this.$expandHolder),this.hoverAllow=!0,f.prototype.considerSlider=function(){n.hoverAllow=!1,n.$sliderOpen.removeClass("tooltip").removeAttr("title"),n.$sliderOpen.delay(300).css({backgroundColor:"#e77e17"}),n.hoverAllow=!0},this.createRight(),this.createLeft()};f.prototype.findScrollTop=function(){var e=r.$body.scrollTop()>0?r.$body.scrollTop():r.$html.scrollTop()>0?r.$html.scrollTop():r.$document.scrollTop();return e},f.prototype.isScrollBottom=function(){var e=r.$body.scrollTop()>0?r.$body.scrollTop():r.$html.scrollTop()>0?r.$html.scrollTop():r.$document.scrollTop(),t=f.prototype.findDocHeight(),o=s.height();return o+e>=t?!1:!0},f.prototype.findDocHeight=function(){var t=[];t.push(e(document).height()),t.push(r.$body.height()),t.push(r.$html.height());var o=Math.max(t[0],t[1],t[2]);return o},e.fn.initializeRibon=function(t){if(0==e(".slider").length){var o={threshold:void 0},n=e.extend({},o,t),i=new f(this,n);i.$holder}},e.fn.reInitialRibonPos=function(){if(void 0!=f.prototype.sliderObj){var e=f.prototype.findDocHeight();f.prototype.isScrollBottom()?e>s.height()?(f.prototype.sliderObj.css("position","fixed"),f.prototype.yPos=f.prototype.$threshold.offset().top):f.prototype.sliderObj.css("position","relative"):(f.prototype.sliderObj.css("position","relative"),f.prototype.yPos=f.prototype.$threshold.offset().top),f.prototype.sliderObj.offset().top>f.prototype.$threshold.offset().top&&f.prototype.sliderObj.css("position","relative")}}}(jQuery);