function IndicesAppCtrl(t,e,o){function r(){this.navItems=$(".navigationItem"),this.activeNav,this.activeContent,this.changeContent=function(){this.activeContent.hide();var t=v.filter("#"+this.activeNav.attr("id")+"Content");t.stop(!0,!1).fadeIn(200),-1!=t[0].id.toLowerCase().indexOf("industry")?a.$helperIcon.mkf_reHelper([{idx_before:firstObjArr[1],idx:firstObjArr[0],phrase:"نمایش نمودار",dir:"bottom"},{idx_before:"h_"+firstObjArr[1],idx:"h_"+firstObjArr[0],phrase:"نمایش نمادهای زیرگروه (کلیک کنید)",dir:"right"}]):a.$helperIcon.mkf_reHelper([{idx_before:firstObjArr[0],idx:firstObjArr[1],phrase:"نمایش نمودار",dir:"bottom"},{idx_before:"h_"+firstObjArr[0],idx:"h_"+firstObjArr[1],phrase:"نمایش نمادهای زیرگروه (کلیک کنید)",dir:"right"}]),this.activeContent=t,a.$content.reInitialRibonPos()},this.initialize=function(){a.$content.reInitialRibonPos()},this.navClick=function(){var t=this;this.navItems.on("click",function(){var e=$(this);t.activeNav.attr("id")!=e.attr("id")&&(e.siblings("li").removeClass("selectedNav").end().addClass("selectedNav"),t.activeNav=e,t.changeContent())})}}t.mainCategories=[],t.industryCategories=[];var n=document.URL.split("#")[1];t.showMain="industry"==n?!1:!0,n=null,t.rowGrade=1,t.openAllSub=!1,t.uiDelay=10,t.activePlotsArray=[],e.get("json/Indices/Indices.json").success(function(e){t.firstObjArr=[e.menu[0].cat[0].is,e.menu[1].cat[0].is],t.fillTable(e.menu,0)}),t.fillTable=function(e,r){return r>=e[1].cat.length?($("#IRX6XTPI0006").click(),t.fillIndustry(e[0].cat,0),void 0):(o(function(){t.mainCategories=t.mainCategories.concat(e[1].cat.slice(r,r+t.rowGrade)),t.fillTable(e,r+t.rowGrade)},t.uiDelay),void 0)},t.fillIndustry=function(e,r){return r>=e.length?(t.endData(),void 0):(o(function(){t.industryCategories=t.industryCategories.concat(e.slice(r,r+t.rowGrade)),t.fillIndustry(e,r+t.rowGrade+1)},t.uiDelay),void 0)},t.isPlotActive=function(e){for(var o=!1,r=0;r<t.activePlotsArray.length;r++){var n=t.activePlotsArray[r];if(n.idx==e){o=!0;break}}return o?r:-1},t.plotClicked=function(e,o){var r=t.isPlotActive(e);-1==r?(t.activePlotsArray.push({idx:e,name:o}),m.call($("#"+e))):(t.activePlotsArray.splice(r,1),u.prototype.removeLine(r,e))},t.removePlot=function(e){var o=t.isPlotActive(e);t.activePlotsArray.splice(o,1),u.prototype.removeLine(o,e)},t.isActive=function(e){return t.isPlotActive(e)>=0?"activePlot":""},t.endData=function(){var e=function(){t.showMain?a.$helperIcon.mkf_helper([{idx:t.firstObjArr[1],phrase:"نمایش نمودار",dir:"bottom"},{idx:"h_"+t.firstObjArr[1],phrase:"مشاهده نمادهای زیرگروه (کلیک کنید)",dir:"right"}]):a.$helperIcon.mkf_helper([{idx:t.firstObjArr[0],phrase:"نمایش نمودار",dir:"bottom"},{idx:"h_"+t.firstObjArr[0],phrase:"نمایش نمادهای زیرگروه (کلیک کنید)",dir:"right"}]),a.$helperIcon.mkf_helper([{idx:"wn",phrase:"تغییر انداره نمودار",dir:"bottom"}]),a.$helperIcon.trigger("click"),a.$content.initializeRibon({threshold:a.$footer})};window.setTimeout(function(){e()},1e3)},t.navSelected=function(e){t.showMain=e?!0:!1},t.getCurrentNavClass=function(e){return"main"==e?t.showMain?"selectedNav":"":t.showMain?"":"selectedNav"},t.changeInput=function(e){t.openAllSub=e.length>0?!0:!1},$(".tabContent").on("keyup","input",function(){var t=$(this),e=t.val();t.val(e.replace(/\ی/g,"ي").replace(/\ک/g,"ك")),t.trigger("input")});var a={$footer:$(document.getElementById("footer")),$chartsContainer:$(document.getElementById("chartsContainer")),$activeListHolder:$(document.getElementById("activePlotListHolder")),$vError:$(document.getElementById("overflowAlert")),$helperIcon:$(document.getElementById("helpIcon")),$content:$(document.getElementById("content")),navSuccess:!1};$(".mkfTooltip").mkfTT({fsize:10,padding:"6px"});var p=$(document),l=$("body"),s=$(window),c=$("html"),n=document.URL,d={obj:$(document.getElementById("plotLoadingBack")),$noPlot:$(document.getElementById("noPlotAv")),show:function(){this.obj.show()},hide:function(){this.obj.hide()}};d.show();var h=function(){var t=function(){};return t.prototype.left=!1,a.$vError.on("click",function(){t.prototype.disappear()}),t.prototype.counter=0,t.prototype.display=function(){a.$vError.stop(!0,!1).fadeIn(200).animate({right:"-176"},{duration:400,queue:!1})},t.prototype.disappear=function(){a.$vError.hide().css("right","-196px")},t}();Window.prototype.findSH=function(){var t=l.scrollTop()>0?l.scrollTop():c.scrollTop()>0?c.scrollTop():p.scrollTop()>0?p.scrollTop():s.scrollTop()>0?s.scrollTop():0;return t},$.fn.magicFix=function(t){var e=this;s.on("scroll",function(){if(Window.prototype.findSH()>t-40){var o=e.offset().left;e.css({top:40,margin:"0",left:o+"px",position:"fixed"})}else e.css({position:"relative",top:0,left:0,"margin-left":"15px"})})},a.$chartsContainer.magicFix(252);var f=function(){var t=function(){};return t.prototype.activeIdx=0,this.$objs=$(document.getElementById("plotZoom")).find("li.zoomItem").on("click",function(){var e=$(this);e.hasClass("zoomSelect")||(t.prototype.activeIdx=e.index()-1,e.addClass("zoomSelect").siblings().removeClass("zoomSelect"),u.prototype.update(e.index()-1))}),t}(),y=function(){this.addSeprator=function(t){var e=t.toString().indexOf("."),o="";if(-1!=e){var r=parseInt(t.toString().substring(0,e));o=t.toString().substring(e,e+3),t=r}var n="";if(1e3>t&&t>-1e3)return t.toString()+o;0>t&&(t-=2*t,n="-");for(var a=[],p=t,l="";p>=1e3;){var s=String(p%1e3);s.length<3&&(s=this.correct(s)),a.push(s),p=parseInt(p/1e3)}for(l+=n+p,i=a.length-1;i>=0;i--)l+=","+a[i];return l+o},this.correct=function(t){var e=3-t.length;for(i=0;e>i;i++)t="0"+t;return t},this.dotReduction=function(t){var e=t.toString().indexOf("."),o="";if(-1!=e){var r=parseInt(t.toString().substring(0,e));o=t.toString().substring(e,e+3),t=r}return parseFloat(t+o)}},u=function(){var t=function(){},e=new y;return t.prototype.chartObj=this.chartObj,t.prototype.noPlot=!0,t.prototype.chartThreshold=5,$("#chartThreshold").html(t.prototype.chartThreshold),t.prototype.activeIconArr=[],t.prototype.allInfoArr=[],t.prototype.initialize=function(o,r,n,i){t.prototype.chartObj=new Highcharts.Chart({chart:{renderTo:o,backgroundColor:null,zoomType:"x"},title:{text:""},tooltip:{style:{direction:"rtl",fontWeight:"bold",fontFamily:"Tahoma",fontSize:"9px",padding:5},useHTML:!0,formatter:function(){var o='<table style="direction:rtl;font-family=Tahoma;text-align:center">';return $.each(this.points,function(r,n){var i=n.series.name.substring(0,n.series.name.indexOf("_")),a=n.series.name.substring(n.series.name.indexOf("_")+1);t.prototype.d||(a="تغییر درصد");var p=n.y,l="#000";0>p?(p+=-(2*p),p=e.addSeprator(p)+"-",l="#da2727"):(p=e.addSeprator(p),t.prototype.d||(l="#33a321"));var s=n.series.color;o+='<tr style="line-height:1.3em"><td style="text-align:right;color:'+s+';font-weight:bold;">'+i+'</td><td style="text-align: right">&nbsp;<b>('+a+":&nbsp;<span style='color:"+l+"'>"+p+"</span>)</b>&nbsp;</td></tr>"}),o+='<tr style="line-height:2.2em;color:#444;"><td style="text-align:left;">تاریخ:</td><td style="text-align:right;"> '+this.x+"</td></tr></table>"},pointFormat:"",footerFormat:"",shared:!0},xAxis:{categories:r,tickInterval:10,tickWidth:0,id:"x-axis",labels:{enabled:!1}},yAxis:{startOnTick:!0,endOnTick:!1,title:{text:null},labels:{style:{fontSize:"9px"},formatter:function(){return e.addSeprator(this.value)}}},credits:{enabled:!0,position:{align:"right",x:-10},text:"بورس اوراق بهادار تهران",href:"http://new.tse.ir",style:{cursor:"pointer",fontSize:"9px",fontFamily:"Droid Arabic Naskh"}},plotOptions:{series:{lineWidth:2,marker:{enabled:!1}}},colors:["#7badae","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"],legend:{borderColor:"#ccc",rtl:!0,symboleHeight:35,itemStyle:{fontFamily:"Tahoma",fontSize:"10px"},labelFormatter:function(){return this.name.substring(0,this.name.indexOf("_"))}},series:[{name:i,data:n}]})},t.prototype.addNewLine=function(e,o){t.prototype.chartObj.addSeries({name:e,data:o}),t.prototype.d=!1},t.prototype.updateIndices=function(e){for(var o=e;o<t.prototype.activeIconArr.length;o++)$(t.prototype.activeIconArr[o]).data("index",parseInt($(t.prototype.activeIconArr[o]).data("index"))-1)},t.prototype.removeLine=function(e){t.prototype.allInfoArr.splice(e,1),$(t.prototype.activeIconArr[e]).data("title","نمایش نمودار").closest("tr").removeClass("highlight"),t.prototype.activeIconArr.splice(e,1),t.prototype.chartObj.series[e].remove(!0),a.$activeListHolder.children("ul").eq(e).remove(),h.prototype.disappear(),t.prototype.updateIndices(e),1==t.prototype.activeIconArr.length?(t.prototype.chartObj.series[0].setData(t.prototype.allInfoArr[0][f.prototype.activeIdx].yData),t.prototype.d=!0):0==t.prototype.activeIconArr.length&&(t.prototype.noPlot=!0,t.prototype.d=!0)},t.prototype.update=function(e){for(var o=0;o<t.prototype.allInfoArr.length;o++){var r=t.prototype.allInfoArr[o][e].yData;t.prototype.d||(r=t.prototype.allInfoArr[o][e].yDataV),t.prototype.chartObj.series[o].setData(r)}t.prototype.chartObj.xAxis[0].update({categories:t.prototype.allInfoArr[0][e].xData})},t}();u.prototype.$chartsContainer=$(document.getElementById("chartsContainer")),u.prototype.d=!0,u.prototype.$wider=$(document.getElementById("wider")),u.prototype.$narrower=$(document.getElementById("narrower")),u.prototype.$backLargePlot=$(document.getElementById("backLargePlot")),u.prototype.$plot=$(document.getElementById("plot")),u.prototype.prevWidth=0,u.prototype.prevState="",u.prototype.largeOpen=!1,u.prototype.$wider.on("click",function(){if(!u.prototype.noPlot){var t=$(this);t.hasClass("active")||(u.prototype.largeOpen=!0,t.toggleClass("active"),u.prototype.$chartsContainer.addClass("z-more"),u.prototype.prevState=u.prototype.$chartsContainer.attr("style"),u.prototype.prevWidth=u.prototype.$chartsContainer.width(),u.prototype.$backLargePlot.fadeIn(50,function(){l.addClass("noOF"),u.prototype.$plot.children().fadeOut(),u.prototype.$chartsContainer.addClass("moreShadow").css({position:"fixed",left:u.prototype.$chartsContainer.offset().left,top:u.prototype.$chartsContainer.offset().top-$("body, html").scrollTop()+"px",margin:0}).animate({width:928},"slow",function(){u.prototype.chartObj.reflow(),u.prototype.$plot.children("div").fadeIn(),u.prototype.$narrower.toggleClass("active")})}))}}),u.prototype.$narrower.on("click.makeSmall",function(){var t=$(this);t.hasClass("active")||(t.toggleClass("active"),u.prototype.$chartsContainer.removeClass("z-more"),u.prototype.$backLargePlot.fadeOut(50,function(){u.prototype.$plot.children().fadeOut(),u.prototype.$chartsContainer.toggleClass("moreShadow").animate({width:u.prototype.prevWidth},"slow",function(){u.prototype.chartObj.reflow(),l.toggleClass("noOF"),u.prototype.$plot.children("div").fadeIn(),$(this).removeAttr("style").attr("style",u.prototype.prevState),u.prototype.$wider.toggleClass("active")})}),u.prototype.largeOpen=!1)}),u.prototype.$backLargePlot.on("click",function(){u.prototype.$narrower.trigger("click.makeSmall")}),u.prototype.$chartsContainer.on("click",function(t){t.stopPropagation()}),$(window).on("keydown",function(t){"27"==t.keyCode&&u.prototype.largeOpen&&u.prototype.$narrower.trigger("click.makeSmall")});var v=$(".tabContent"),g=new r;g.initialize();var m=($(document.getElementById("interaction")),$(document.getElementById("mainIdContent")),$(document.getElementById("industryIdContent")),function(){var t=this;if(u.prototype.allInfoArr.length<u.prototype.chartThreshold){var e=t.hasClass("catPlotIcon")?t.siblings("h5").text():t.next().find("a").text();d.show();var o=t.hasClass("catPlotIcon")?"json/Indices/Plot/":"json/Instrument/";$.getJSON(o+"plot_"+t[0].id+".json",function(o){d.hide(),u.prototype.activeIconArr.push(t[0]),t.data("title","حذف نمودار").data("index",u.prototype.allInfoArr.length).closest("tr").addClass("highlight");var r=t.hasClass("catPlotIcon")?"مقدار":"قیمت";u.prototype.noPlot?(u.prototype.initialize("plot",o.plotData[f.prototype.activeIdx].xData,o.plotData[f.prototype.activeIdx].yData,e+"_"+r),u.prototype.noPlot=!1):(u.prototype.addNewLine(e+"_"+r,o.plotData[f.prototype.activeIdx].yDataV),u.prototype.chartObj.series[0].setData(u.prototype.allInfoArr[0][f.prototype.activeIdx].yDataV)),u.prototype.allInfoArr.push(o.plotData)}).fail(function(){d.$noPlot.slideDown(200),window.setTimeout(function(){d.obj.fadeOut(200,function(){d.$noPlot.hide()})},2e3)})}else h.prototype.display()})}IndicesAppCtrl.$inject=["$scope","$http","$timeout"];